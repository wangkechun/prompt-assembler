# prompt-assembler
Prompt Assembler - æ™ºèƒ½æç¤ºè¯ï¼ˆPromptï¼‰ç”Ÿæˆå¼•æ“


**Prompt Assembler** æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ—¨åœ¨å°†ç¼–å†™å¤æ‚çš„å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æç¤ºè¯ï¼ˆPromptï¼‰ä»ç¹ççš„æ‰‹å·¥"å¤åˆ¶ç²˜è´´"ä¸­è§£æ”¾å‡ºæ¥ã€‚å®ƒåˆ©ç”¨ Jinja2 æ¨¡æ¿å¼•æ“ï¼Œå…è®¸ä½ é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼ï¼ŒåŠ¨æ€åœ°ã€æ™ºèƒ½åœ°ä»ä½ çš„é¡¹ç›®æ–‡ä»¶å’Œç›®å½•ä¸­ç»„è£…ä¸Šä¸‹æ–‡ï¼Œç”Ÿæˆæœ€ç»ˆçš„æç¤ºè¯ã€‚

> å‘Šåˆ«æ‰‹åŠ¨ç»´æŠ¤å·¨å¤§çš„ `prompt.txt` æ–‡ä»¶ï¼Œè®©ä½ çš„ Prompt å’Œä½ çš„ä»£ç åº“åŒæ­¥è¿›åŒ–ï¼

âœ¨ åŠŸèƒ½ç‰¹æ€§
------

-   **æ¨¡æ¿é©±åŠ¨**ï¼šä½¿ç”¨å¼ºå¤§çš„ [Jinja2](https://jinja.palletsprojects.com/) æ¨¡æ¿è¯­è¨€å®šä¹‰ä½ çš„ Prompt ç»“æ„ã€‚

-   **æ–‡ä»¶åµŒå…¥** (`include_file`): ç²¾ç¡®åœ°å°†å•ä¸ªæ–‡ä»¶å†…å®¹åµŒå…¥åˆ°æç¤ºè¯ä¸­ã€‚

-   **ç›®å½•æ‰«æ** (`include_dir`): é€’å½’åœ°åŒ…å«æ•´ä¸ªç›®å½•çš„æ–‡ä»¶ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„ `glob` æ¨¡å¼å’Œå…³é”®è¯è¿‡æ»¤ã€‚

-   **æ¨¡ç³ŠåŒ¹é…** (`include_fuzzy`): æ ¹æ®ä¸ç²¾ç¡®çš„æ–‡ä»¶åæ™ºèƒ½æŸ¥æ‰¾å¹¶åŒ…å«æ–‡ä»¶ï¼Œå‘Šåˆ«å› æ‹¼å†™é”™è¯¯æˆ–è·¯å¾„é—å¿˜å¸¦æ¥çš„çƒ¦æ¼ã€‚

-   **Token æŠ¥å‘Š**: åœ¨ç”Ÿæˆ Prompt åï¼Œè‡ªåŠ¨æä¾›è¯¦ç»†çš„ Token æ¶ˆè€—æŠ¥å‘Šï¼Œå¸®åŠ©ä½ ç®¡ç†å’Œä¼˜åŒ–ä¸Šä¸‹æ–‡çª—å£ã€‚

-   **è·¨å¹³å°å‰ªè´´æ¿**: ç”Ÿæˆçš„ Prompt ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°ä½ çš„ç³»ç»Ÿå‰ªè´´æ¿ä¸­ï¼Œæ–¹ä¾¿ç«‹å³ä½¿ç”¨ã€‚

-   **é…ç½®çµæ´»**: æ”¯æŒè‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶ã€é€‰æ‹© Token è®¡ç®—æ¨¡å‹ç­‰ã€‚

ğŸ“¦ å®‰è£…æŒ‡å—
-------

1.  **å…‹éš†é¡¹ç›®**

    Bash

    ```
    git clone https://github.com/your-username/prompt-assembler.git
    cd prompt-assembler

    ```

2.  **å®‰è£…ä¾èµ–**

    å»ºè®®åœ¨ Python è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…ä¾èµ–ã€‚

    Bash

    ```
    # åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (å¯é€‰ä½†æ¨è)
    python -m venv venv
    source venv/bin/activate  # On Windows, use `venv\Scripts\activate`

    # å®‰è£…ä¾èµ–
    pip install -r requirements.txt

    ```

3. **è¿è¡Œç¤ºä¾‹**

    Bash

    ```
    python3 prompt_assembler.py example/my_prompt.j2
    ```


ğŸ“š ä½¿ç”¨æ•™ç¨‹
-------

ä½¿ç”¨ Prompt Assembler åªéœ€ä¸‰æ­¥ï¼šåˆ›å»ºç›®å½•ç»“æ„ -> ç¼–å†™æ¨¡æ¿ -> è¿è¡Œå‘½ä»¤ã€‚

### æ­¥éª¤ 1: å‡†å¤‡ä½ çš„é¡¹ç›®ç›®å½•ç»“æ„

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```
my_project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ helpers.py
â”‚   â”‚   â””â”€â”€ data_processor.py
â”‚   â””â”€â”€ config.json
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ requirements_v2.md
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ my_prompt.j2
â””â”€â”€ prompt_assembler.py

```

### æ­¥éª¤ 2: ç¼–å†™ä½ çš„ Jinja2 æ¨¡æ¿

åœ¨ `templates/` ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª `.j2` æ–‡ä»¶ï¼Œä¾‹å¦‚ `my_prompt.j2`ã€‚åœ¨è¿™ä¸ªæ¨¡æ¿é‡Œï¼Œä½ å°†å®šä¹‰ Prompt çš„æœ€ç»ˆç»“æ„ï¼Œå¹¶ä½¿ç”¨æˆ‘ä»¬æä¾›çš„è‡ªå®šä¹‰å‡½æ•°æ¥"æ‹‰å–"ä¸Šä¸‹æ–‡ã€‚

**`templates/my_prompt.j2`**

Django

```
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ Python æ¶æ„å¸ˆã€‚æˆ‘éœ€è¦ä½ ä¸ºä»¥ä¸‹é¡¹ç›®æ’°å†™ä¸€ä»½æŠ€æœ¯æ¶æ„è¯„å®¡ã€‚

è¿™æ˜¯é¡¹ç›®çš„æ ¸å¿ƒéœ€æ±‚æ–‡æ¡£ï¼š
{{ include_file('../docs/requirements_v2.md') }}

è¿™æ˜¯é¡¹ç›®çš„ä¸»è¦æºä»£ç ã€‚è¯·æ³¨æ„ï¼Œæˆ‘æ’é™¤äº†ä¸€äº›ä¸å¿…è¦çš„æ–‡ä»¶ï¼š
{{ include_dir(
    '../src',
    glob_pattern='**/*.py',
    exclude_patterns=['**/__pycache__/*']
) }}

æˆ‘ä¸å¤ªç¡®å®šé…ç½®æ–‡ä»¶çš„ç¡®åˆ‡åç§°ï¼Œä½†å®ƒåº”è¯¥åœ¨ src ç›®å½•ä¸‹ï¼Œå¹¶ä¸”å’Œ 'config' ç›¸å…³ï¼š
{{ include_fuzzy('../src/configuration.json') }}

åŸºäºä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ï¼Œè¯·ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œè¯„å®¡ï¼š
1.  ä»£ç ç»“æ„æ˜¯å¦åˆç†ï¼Ÿ
2.  æ˜¯å¦å­˜åœ¨æ˜æ˜¾çš„æ€§èƒ½ç“¶é¢ˆï¼Ÿ
3.  æœ‰æ²¡æœ‰å¯ä»¥æ”¹è¿›çš„è®¾è®¡æ¨¡å¼ï¼Ÿ

```

### æ­¥éª¤ 3: è¿è¡Œå‘½ä»¤ç”Ÿæˆ Prompt

æ‰“å¼€ç»ˆç«¯ï¼Œè¿è¡Œ `prompt_assembler.py` è„šæœ¬ï¼Œå¹¶æŒ‡å‘ä½ çš„æ¨¡æ¿æ–‡ä»¶ã€‚

Bash

```
python prompt_assembler.py templates/my_prompt.j2 -o final_prompt.txt

```

### æ­¥éª¤ 4: æŸ¥çœ‹ç»“æœ

è¿è¡Œåï¼Œä½ ä¼šå¾—åˆ°ï¼š

1.  **ç»ˆç«¯è¾“å‡º**:

    ```
    âœ… ç»“æœå·²ç»å¤åˆ¶åˆ°å‰ªè´´æ¿
    âœ… ç»“æœå·²ç»ä¿å­˜åˆ° ./final_prompt.txt
    INFO: æ¨¡ç³ŠæŸ¥æ‰¾ '../src/configuration.json' -> åŒ¹é…åˆ° 'src/config.json' (Partial Ratio è¯„åˆ†: 90.00%)

    --- Token Usage Report (Top 10) ---
       Tokens |   Percentage | File Path
    ---------+--------------+-----------------------
        1,205 |       45.15% | src/utils/helpers.py
          850 |       31.84% | src/main.py
          412 |       15.43% | docs/requirements_v2.md
          180 |        6.74% | src/utils/data_processor.py
           22 |        0.82% | src/config.json

    âœ… Total Tokens: 2,669

    ```

2.  **æ–‡ä»¶ `final_prompt.txt`**: ä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰æ–‡ä»¶å†…å®¹çš„ã€å¯ä»¥ç›´æ¥ä½¿ç”¨çš„å®Œæ•´ Promptã€‚

3.  **å‰ªè´´æ¿**: å®Œæ•´ Prompt å·²åœ¨ä½ çš„å‰ªè´´æ¿é‡Œï¼Œéšæ—¶å¯ä»¥ç²˜è´´åˆ° LLM å¯¹è¯æ¡†ä¸­ã€‚

ğŸ› ï¸ å‡½æ•° API å‚è€ƒ
-------------

ä½ å¯ä»¥åœ¨ Jinja2 æ¨¡æ¿ä¸­ä½¿ç”¨ä»¥ä¸‹ä¸‰ä¸ªå¼ºå¤§çš„å‡½æ•°ï¼š

### 1\. `include_file()`

ç²¾ç¡®åµŒå…¥å•ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚

-   **ç­¾å**: `include_file(path: str, show_filename: bool = True, tag: str = "PROMPT_SNIPPET_FILE")`

-   **å‚æ•°**:

    -   `path`: å¿…å¡«ï¼Œç›¸å¯¹äºæ¨¡æ¿æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ã€‚

    -   `show_filename`: å¯é€‰ï¼Œæ˜¯å¦åœ¨åŒ…è£¹å†…å®¹çš„ XML æ ‡ç­¾ä¸­æ˜¾ç¤º `path` å±æ€§ã€‚

    -   `tag`: å¯é€‰ï¼Œç”¨äºåŒ…è£¹å†…å®¹çš„ XML æ ‡ç­¾åã€‚è®¾ä¸º `'none'` åˆ™ä¸æ·»åŠ ä»»ä½•æ ‡ç­¾ã€‚

### 2\. `include_dir()`

é€’å½’åœ°åµŒå…¥ä¸€ä¸ªç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œå¹¶æä¾›å¼ºå¤§çš„è¿‡æ»¤èƒ½åŠ›ã€‚

-   **ç­¾å**: `include_dir(path: str, glob_pattern: str = "**/*", exclude_patterns: list = None, exclude_keywords: list = None, tag: str = "directory")`

-   **å‚æ•°**:

    -   `path`: å¿…å¡«ï¼Œç›¸å¯¹äºæ¨¡æ¿æ–‡ä»¶çš„ç›®å½•è·¯å¾„ã€‚

    -   `glob_pattern`: å¯é€‰ï¼Œç”¨äºåŒ¹é…æ–‡ä»¶çš„ glob æ¨¡å¼ï¼ˆä¾‹å¦‚ `**/*.py`ï¼‰ã€‚

    -   `exclude_patterns`: å¯é€‰ï¼Œä¸€ä¸ª `glob` æ¨¡å¼åˆ—è¡¨ï¼ŒåŒ¹é…åˆ°çš„æ–‡ä»¶å°†è¢«æ’é™¤ã€‚

    -   `exclude_keywords`: å¯é€‰ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹åŒ…å«ä»»ä¸€å…³é”®è¯ï¼Œè¯¥æ–‡ä»¶å°†è¢«æ’é™¤ã€‚

    -   `tag`: å¯é€‰ï¼Œç”¨äºåŒ…è£¹æ•´ä¸ªç›®å½•å†…å®¹çš„ XML æ ‡ç­¾åã€‚

### 3\. `include_fuzzy()`

æ ¹æ®è¿‘ä¼¼è·¯å¾„æ¨¡ç³ŠæŸ¥æ‰¾å¹¶åµŒå…¥å•ä¸ªæ–‡ä»¶ã€‚

-   **ç­¾å**: `include_fuzzy(approximate_path: str, similarity_threshold: int = 85, tag: str = "PROMPT_SNIPPET_FILE")`

-   **å‚æ•°**:

    -   `approximate_path`: å¿…å¡«ï¼Œä¸€ä¸ªå¯èƒ½ä¸å‡†ç¡®çš„æ–‡ä»¶è·¯å¾„ã€‚è„šæœ¬å°†åœ¨å…¶çˆ¶ç›®å½•ä¸­è¿›è¡Œæ¨¡ç³Šæœç´¢ã€‚

    -   `similarity_threshold`: å¯é€‰ï¼ŒåŒ¹é…çš„ç›¸ä¼¼åº¦åˆ†æ•°é˜ˆå€¼ï¼ˆ0-100ï¼‰ã€‚

    -   `tag`: å¯é€‰ï¼ŒåŒ `include_file`ã€‚

âš™ï¸ å‘½ä»¤è¡Œé€‰é¡¹
--------

```
usage: prompt_assembler.py [-h] [-o OUTPUT] [--no-clipboard] [--model MODEL] template_file

ä¸€ä¸ªæ™ºèƒ½çš„æç¤ºè¯ï¼ˆPromptï¼‰ç”Ÿæˆå¼•æ“ã€‚

positional arguments:
  template_file         Jinja2 æ¨¡æ¿æ–‡ä»¶çš„è·¯å¾„ (.j2)ã€‚

options:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        ä¿å­˜ç»“æœçš„è¾“å‡ºæ–‡ä»¶è·¯å¾„ (é»˜è®¤: output.txt)ã€‚
  --no-clipboard        ä¸å°†ç»“æœå¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿ã€‚
  --model MODEL         ç”¨äº token è®¡ç®—çš„æ¨¡å‹ (é»˜è®¤: gpt-4o)ã€‚

```

ğŸ¤ è´¡çŒ®
-----

æ¬¢è¿æäº¤ Pull Requests æˆ–å¼€å¯ Issues æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

ğŸ“„ è®¸å¯è¯
------

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](https://www.google.com/search?q=LICENSE&authuser=2)ã€‚
